---
# tasks file for sssd_ldap
- name: Install SSSD and LDAP-uttils
  ansible.builtin.apt:
    name:
      - sssd
      - sssd-tools
      - ldap-utils
    update_cache: true
    state: present
  become: true

- name: Copy file /etc/sssd/sssd.conf
  ansible.builtin.copy:
    mode: "0600"
    src: sssd.conf
    dest: /etc/sssd/sssd.conf
  become: true
  notify:
    - Restart SSSD deamon

- name: Copy file /etc/ssh/sshd_config.d/10-sshd-sssd.conf
  ansible.builtin.copy:
    mode: "0644"
    src: 10-sshd-sssd.conf
    dest: /etc/ssh/sshd_config.d/10-sshd-sssd.conf
  become: true
  notify:
    - Restart sshd deamon

- name: PAM add mkhomedir
  community.general.pamd:
    name: common-session
    state: after
    type: session
    control: optional
    module_path: pam_systemd.so
    new_type: session
    new_control: optional
    new_module_path: pam_mkhomedir.so
  become: true
